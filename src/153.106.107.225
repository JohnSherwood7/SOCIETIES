from optparse import OptionParser
import numpy as np
import csv

parser = OptionParser()
parser.add_option("-d", "--days", dest="dayNumber", help="the last number of days to be calculated")
parser.add_option("-l", "--location", dest="directory", help="the name of the folder where the csv files are stored")
(options, args) = parser.parse_args()

"""
Calculate Income:
average units gathered per agent over the last -d days;
and the SD
"""
csvfile = open(options.directory + "/unitsHeld.csv")
csvreader = csv.reader(csvfile)
data = []
'''to store the average unitsHeld of the last days for each day'''
avg = []
'''to store the standard deviation of the last days for each day'''
sd = []

for row in csvreader:
    if options.dayNumber <= len(row):
        print "The number of days in the csv file is smaller than the number of days you want to calculate."
        exit()
    '''
    The last item in each row is '\n' generated by societies program.
    Delete it.
    '''
    del row[len(row)-1]
    del row[0]
    for i in range(len(row)):
        row[i] = float(row[i])
    data.append(row)
'''
The first rows in the csv file is day number.
Delete it.
'''
del data[0]

'''Calculate average and sd'''
for row in data:
    avg.append(np.mean(row[len(row)-int(options.dayNumber):len(row)]))
    sd.append(np.std(row[len(row)-int(options.dayNumber):len(row)]))
print("Income (units gathered per agent averaged over last " + options.dayNumber + " days): average = " + str(np.mean(avg)) + "; SD = " + str(np.mean(sd)))
print avg
print sd

    
    
